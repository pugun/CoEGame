<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script>
            $(document).ready(function () {
                $("#login-form").submit(e => {
                    e.preventDefault();
                    login();
                });
            });
    
    
            function login() {
                post($("#login-form"), "login", res => {
                    if (res.ok) {
                        window.location = "/test.html";
                    } else {
                        alert("Wrong username or password");
                    }
                });
            }
    
            const root = "http://localhost:3000/users/";
            function getUri(name) { return root + name; }
    
            function post(form, endPoint, func) {
                try {
                    console.log(JSON.stringify(form));
                    fetch(getUri(endPoint), PostOptions(formToObject(form.serializeArray())))
                        .then(response => {
                            func(response);
                        })
                        .catch(err => {
                            console.log(err);
                        });
                }
                catch (err) {
                    alert(err);
                }
            }
    
            function PostOptions(obj) {
                return options = {
                    method: "POST",
                    body: JSON.stringify(obj),
                    headers: {
                        "Content-Type": "application/json"
                    },
                    credentials: "include"
                };
            }
    
            function formToObject(obj) {
                resultObj = new Object();
                for (i = 0; i < obj.length; i++) {
                    resultObj[obj[i]["name"]] = obj[i]["value"];
                }
                return resultObj;
            }
        </script>

</head>

<body>

    <h2>Login Form</h2>

    <div id="login">
        <form id="login-form" action="#" method="POST">
            Username: <input type="text" name="username" value="testingAPI" /><br /><br />
            Password: <input type="password" name="password" value="testingAPI" /><br /><br />
            <input type="submit" value="Login" />
        </form>
    </div>

    

</body>

</html>